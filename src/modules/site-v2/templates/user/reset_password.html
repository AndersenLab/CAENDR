{% extends "_layouts/clean.html" %}
{% block content %}
{% from "_includes/macros.html" import render_field %}

<div class="row">
  <div class="col-md-6 col-md-offset-3">
    <p style="text-align:center; position:relative;"><img src="{{ ext_asset('img/logo.png') }}" alt="CaeNDR Logo"  style="margin-right:40px; max-height:150px; margin: auto; display: inline; margin:20px;" class=" img-responsive"/></p>
    <h1 class='text-center'>Reset Password</h1>
    <hr />
    <br />
    <div class="panel panel-default">
      <div class="panel-heading">Reset Password</div>
      <div class="panel-body">
        <form id='form-submit' method="POST" action="reset">
          <input hidden name="password_reset_token" value="{{ request.args.get('token', None) }}">
          {{ form.csrf_token }}
          {{ render_field(form.password) }}
          {{ render_field(form.confirm_password) }}
          {{ form.recaptcha }}
          <br />
          <button id='reset' type='submit' value="Reset Password" class="btn btn-primary btn-block" disabled>
            Reset Password
          </button>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block script %}
<script>
  $(document).ready(function () {
    function toggleSubmitBtn(disabled) {
      $("#reset").attr('disabled', disabled)
    }

    function isInRange(string) {
      const len = string.length
      return len >= 12 && len <= 30
    }

    $('form').change(event => {
      event.preventDefault()
      const password = $('#password').val().trim()
      const confirm_password = $('#confirm_password').val().trim()
      const formCompleted = !!password && !!confirm_password
      const validLength = isInRange(password)
      const isEqual = password === confirm_password
    
      toggleSubmitBtn(!formCompleted || !isEqual || !validLength)
    })
  }
  );
</script>
{% endblock %}