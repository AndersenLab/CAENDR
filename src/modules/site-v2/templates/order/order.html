{% extends "_layouts/default.html" %}

{% block custom_head %}
<style>
    #tableContainer {
        background-color: #e9e9e9;
        padding: 2rem;
        margin: auto;
        max-width: 800px;
    }
    #orderTable {
        max-width: 650px;
    }
    #orderTable th {
        border-bottom: 1px solid black
    }
    #info {
        background-color: #d9dbf8;
        max-width: 650px;

    }
    #info i {
        color: #0719BC;
        font-size: 1.5rem
    }
    #form-submit {
        margin: 50px
    }
    #checkout {
        color: white;
        width: 80%;
        margin-left: 50px;
    }
    #shippingInfo, #paymentInfo {
        background-color: #e9e9e9;
        padding: 40px;
        margin: 30px
    }
    h3 {
        text-align: center;
    }
    .form-group {
        margin: 10px
    }
</style>
{% endblock %}

{% block content %}
<div class="row">
    <div id="tableContainer">
        <table class="table table-striped m-4" id="orderTable">
            <thead>
                <tr>
                    <th style="width: 40px">#</th>
                    <th style="width: 250px">Species</th>
                    <th style="width: 200px;">Strain/Set</th>
                    <th class="price">Price</th>
                </tr>
            </thead>
            <tbody class="searchable">
                {% for item, price in form.item_price() %}
                <tr>
                    <td>{{ loop.index }}</td>
                    {% if 'set' in item %}
                    <td></td>
                    {% else %}
                        {% for isotype, strain in strain_listing|groupby('isotype') %}
                            {% if item == isotype %}
                            <td><i>{{ strain[0].species }}</i></td>
                            {% endif %}
                        {% endfor %}
                    {% endif%}
                    <td>{{ item }}</td>
                    <td class="price">${{'%0.2f'| format(price|float)}}</td>
                </tr>
                {% endfor %}
                <tr>
                    <td colspan="3"><strong>Total:</strong></td>
                    <td class="price"><strong>${{'%0.2f'| format(form.total|float)}}</strong></td>
                </tr>
            </tbody>
        </table>
        <div id="info" class="d-flex flex-row p-2 m-4">
            <i class="bi bi-info-circle-fill p-3"></i>
            <p> If you are ordering a ready-made set, the strains will be sent as frozen stocks on dry ice. Please select a shipping carrier from the drop-down menu and enter an account number. If you are ordering a customized set of strains, these strains will be sent on plates. </p>
        </div>
    </div>
</div>

{% from "_includes/macros.html" import render_field %}


<form id='form-submit' method="POST">
    <div class="row">
        <div class="col">
            <h3>Shipping Information</h3>
            <div id="shippingInfo">
                {# Renders list of strains being ordered #}
                {% for item in form.items %}
                    {{ item }}
                {% endfor %}

                {{ form.csrf_token }}
                {{ render_field(form.name) }}
                {{ render_field(form.email) }}
                {{ render_field(form.phone, placeholder="(847)-867-5309") }}
                {{ render_field(form.address, placeholder="123 Sheridan Rd.\nChicago IL. 60657") }}
                {{ render_field(form.shipping_service) }}
                {{ render_field(form.shipping_account) }}
            </div>
        </div>
        <div class="col">
            <div>
                <h3>Payment Information</h3>
                <div id="paymentInfo">
                    {{ render_field(form.payment) }}
                    {{ render_field(form.comments) }}
                    <small>If you choose to pay by credit card, an account will be generated for you in Northwestern's Core Facility, NUcore. If there is a business administration person who will oversee the payment, please include that person's name and email address in the comments field. They will be added to your NUcore account.</small>
                </div>
            </div>
            <button value="Checkout" class="btn btn-secondary" id="checkout">
                <i class="bi bi-cart-fill"></i>
                Order Now
            </button>
        </div>
    </div>
</form>

<script>

$("#checkout").on('click', function() {

    $.pause = function( callback, seconds){
       return window.setTimeout( callback, seconds * 1000 );
    }

    $(this).text("Please wait...")
           .addClass('disabled')
           .delay(5000)

    var checkout_btn =  $(this);
    $.pause(function() {
        checkout_btn.removeClass('disabled').text("Order")
    }, 5)
})
</script>
{% endblock %}
